<html>
<head>
<title>Blockly-test</title>
</head>
<body>
<!--Share your blocks with this link:https://blockly-demo.appspot.com/static/demos/blockfactory/index.html#9haw7j -->
<script src="blockly/google-blockly-706080c/blockly_compressed.js"></script>
<script src="blockly/google-blockly-706080c/javascript_compressed.js"></script>
<script src="blockly/google-blockly-706080c/blocks_compressed.js"></script>
<script src="blockly/google-blockly-706080c/msg/js/nl.js"></script>
<script src="blockly/custom_blocks/blocks_generators_together.js"></script>
<div id="blocklyDiv" style="height: 480px; width: 400px;position:absolute;right:0px"></div>
<table style="position:absolute;left:0px">
<tr>
<td>
<textarea rows="30" cols="40" id="vertaling"></textarea>
</td>
<td>
<div style="-webkit-appearance:button;padding:5px;cursor:hand" onClick="document.getElementById('vertaling').value=Blockly.Xml.domToPrettyText(Blockly.Xml.workspaceToDom(Blockly.mainWorkspace))">&lt;naar xml</div>

</td>
</tr>
</table>
<xml id="toolbox" style="display: none">
  <!--<category name="Control">
    <block type="controls_if"></block>
    <block type="controls_whileUntil"></block>
  </category>
  <category name="Logic">
    <block type="logic_compare"></block>
    <block type="logic_operation"></block>
    <block type="logic_boolean"></block>
  </category>
  <category name="Variables" custom="VARIABLE"></category>
  <category name="Functions" custom="PROCEDURE"></category>
  <category name="Custom">
	<block type="draai_bakboord"></block>
	<block type="draai_stuurboord"></block>
	<block type="maak_rechtsomkeert"></block>
	<block type="ga_achteruit"></block>
	<block type="ga_een_knoop"></block>
	<block type="ga_twee_knopen"></block>
	<block type="ga_drie_knopen" deletable="false"></block>
	<block type="voer_uit"></block>
  </category>
  <category name="Math">
	<block type="math_number"></block>
  </category>-->
</xml>

<script>
var fillBlocklyWithDeck=function(blockly, deck){
	var xml={
		start: '<xml xmlns="http://www.w3.org/1999/xhtml">',
		blockStrings: [],
		currentBlockId: 9,
		end: '</xml>',
		addBlockString: function(blockString){this.blockStrings[this.blockStrings.length]=blockString;},
		addBlock: function(type, x, y, howManyTimes){
			for(var i=1;i<=howManyTimes;i++){
				this.addBlockString('<block type="'+type+'" id="'+this.currentBlockId+'" deletable="false" x="'+x+'" y="'+y+'"></block>');
				this.currentBlockId+=9;
			}
		},
		toString: function(){
			var s=this.start;
			for(var i=0;i<this.blockStrings.length;i++){s+=this.blockStrings[i];}
			return s+this.end;
		}
	};
	xml.addBlock('voer_uit',10,120,1);
	for(cardType in deck){
		if(cardType==="one knot"){xml.addBlock('ga_een_knoop',10,10, deck[cardType]);}
		if(cardType==="two knots"){xml.addBlock('ga_twee_knopen',10,10,deck[cardType]);}
		if(cardType==="three knots"){xml.addBlock('ga_drie_knopen',10,10,deck[cardType]);}
		if(cardType==="turn port"){xml.addBlock('draai_bakboord',10,10,deck[cardType]);}
		if(cardType==="turn starboard"){xml.addBlock('draai_stuurboord',10,10,deck[cardType]);}
		if(cardType==="turn stern"){xml.addBlock('maak_rechtsomkeert',10,10,deck[cardType]);}
		if(cardType==="retreat"){xml.addBlock('ga_achteruit',10,10,deck[cardType]);}
	}
	var dom=blockly.Xml.textToDom(xml.toString());
	blockly.Xml.domToWorkspace(Blockly.mainWorkspace, dom);
};
var myDeck=function(one, two, three, port, star, stern, ret){return {
	"one knot": one,
	"two knots": two,
	"three knots": three,
	"turn port": port,
	"turn starboard": star,
	"turn stern": stern,
	"retreat": ret
};}
var PuzzleMover=function(blockly){
	this.moveStrings=(function(){
		if(typeof blockly==="undefined"||!blockly.hasOwnProperty("JavaScript")){return [];}
		var matches=blockly.JavaScript.workspaceToCode().match(/\[\s*(".*?",\s*?)+?\]/g);
		if(matches==null){return [];}
		var s=matches[matches.length-1];
		var validMoveStrings=["turn port", "turn starboard", "turn stern", "retreat", "one knot", "two knots", "three knots"];
		var moveStrings=(function(){
			var moveStrings=s.substring(1,s.length-1).split(/,/g);
			var moveStrings1=[];
			for(var i=0;i<moveStrings.length;i++){
				if(moveStrings[i]!=""){
					var moveString=moveStrings[i].replace(/['"]/g,"").trim();
					if(validMoveStrings.indexOf(moveString)!=-1){moveStrings1[moveStrings1.length]=moveString;}
				}
			}
			return moveStrings1;
		})();
		return moveStrings;
	})();
	var self=this;
	this.mover=function(toBeMoved){
		this.moveStrings=self.moveStrings;
		this.moved=0;
		this.isDone=function(){return this.moved==this.moveStrings.length;}
		this.nextMoveString=function(){
			if(this.isDone()){return "";}
			return this.moveStrings[this.moved++];
		};
		this.toBeMoved=toBeMoved;
		var self1=this;
		this.move=(function(){
			if(typeof self1.toBeMoved==="string"){
				return function(moveString){
					this.toBeMoved=this.toBeMoved+" did '"+moveString+"', ";
				}
			}
			return function(moveString){return;};
		})();
		this.moveNext=function(){
			var moveString=this.nextMoveString();
			if(moveString!=""){
				this.move(moveString);
			}
			return !this.isDone();
		};
		this.moveAll=function(){
			while(this.moveNext()){}
			return false;
		};
		this.getToBeMoved=function(){return this.toBeMoved;}
	};
	this.newMover=function(puzzle){
		return new this.mover(puzzle);
	};
};

var vertaal=function(){document.getElementById('vertaling').value=Blockly.JavaScript.workspaceToCode();}
 
Blockly.inject(document.getElementById('blocklyDiv'),{toolbox: document.getElementById('toolbox')});
</script>

</body>
</html>